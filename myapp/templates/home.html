<!-- home.html -->
{% extends 'base.html' %}

{% block title %}
  BarberSync
{% endblock %}

{% block content %}
  <div class="container mt-5">
    <h2 class="mb-4">Agendamentos</h2>
    <form method="post" action="{% url 'home' %}" class="mb-4">
      {% csrf_token %}
      <div class="d-flex flex-wrap align-items-end">
        <div class="form-group mr-3 m-1">
          <label for="tipo_filtro">Selecione o Filtro:</label>
          <select name="tipo_filtro" id="tipo_filtro" class="form-control">
            <option value="dia">Dia</option>
            <option value="semana">Semana</option>
            <option value="mes">Mês</option>
            <option value="ano">Ano</option>
          </select>
        </div>
        <div class="form-group mr-3 m-1">
          <label for="barbeiro_id"></label>
          <select name="barbeiro_id" id="barbeiro_id" class="form-control">
            <option value="">Todos os barbeiros</option>
            {% for barbeiro in barbeiros %}
              <option value="{{ barbeiro.id }}">{{ barbeiro.nome_barbeiro }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="btn btn-primary m-1">Filtrar</button>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="thead-dark">
          <tr>
            <th class="text-light">Data e Hora</th>
            <th class="text-light">Nome</th>
            <th class="text-light">Telefone</th>
            <th class="text-light">Status</th> <!-- Adiciona uma coluna para a ação de atualização de status -->
          </tr>
        </thead>
        <tbody>
          {% for agendamento in agendamentos %}
            <tr>
              <td class="text-light">{{ agendamento.datetime_agendamento|date:'d/m/Y H:i' }}</td>
              <td class="text-light">{{ agendamento.nome_cliente }}</td>
              <td class="text-light">{{ agendamento.telefone }}</td>
              <td>
                <!-- Coluna para o formulário de atualização de status -->
                <form id="form-{{ agendamento.id }}" action="{% url 'atualizar_status' agendamento.id %}" method="post">
                  {% csrf_token %}
                  <div class="input-group">
                    <!-- Adicione as classes 'input-group-prepend' e 'input-group-text' para o elemento que você deseja adicionar antes do campo de entrada -->
                    <!-- Adicione a classe 'form-control' para o campo de entrada -->
                    <input type="number" class="form-control" style="width: 30px;" name="valor_cobrado" id="valor_cobrado_{{ agendamento.id }}" placeholder="R$" required />
                    <!-- Adicione o botão 'Concluir' -->
                    <div class="input-group-append">
                      <button type="button" class="btn btn-success" onclick="confirmarConclusao({{ agendamento.id }})">Concluir</button>
                    </div>
                  </div>
                </form>
              </td>
            </tr>
          {% endfor %}

          <script>
            function confirmarConclusao(agendamentoId) {
              // Obtém o valor do campo de valor
              var valorCobrado = document.getElementById('valor_cobrado_' + agendamentoId).value
            
              // Verifica se o valor foi preenchido
              if (!valorCobrado) {
                alert('Por favor, insira o valor do serviço.')
                return
              }
            
              // Confirmação adicional, se desejar
              if (!confirm('Tem certeza de que deseja concluir este agendamento?')) {
                return
              }
            
              // Envia o formulário
              document.getElementById('form-' + agendamentoId).submit()
            }
          </script>
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
